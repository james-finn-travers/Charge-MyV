<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <% if user_signed_in? %>
    <div class="mb-6 p-4 bg-green-50 border border-green-200 rounded-md">
      <p class="text-green-800 text-sm">
        Welcome back! Use the filters below to find charging stations near you.
      </p>
    </div>
  <% end %>
  
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900">Find Charging Stations</h1>
    
    <%= form_tag find_stations_path, method: :get, class: "mt-4 space-y-4" do %>
      <div class="max-w-lg mx-auto">
        <div class="flex gap-4">
          <div class="flex-1">
            <%= label_tag :location, "Address or Location", class: "block text-sm font-medium text-gray-700" %>
            <%= text_field_tag :location, params[:location], 
                class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",
                placeholder: "Enter address or city" %>
          </div>
          
          <div class="w-32">
            <%= label_tag :radius, "Radius (km)", class: "block text-sm font-medium text-gray-700" %>
            <%= number_field_tag :radius, params[:radius] || 10, 
                class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",
                min: 1, max: 50 %>
          </div>
        </div>
      </div>

      <%= submit_tag "Search", class: "mt-4 px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700" %>
    <% end %>

    <button id="useLocation" class="mt-2 text-sm text-indigo-600 hover:text-indigo-800">
      Use my current location
    </button>
  </div>

  <div class="bg-white shadow overflow-hidden sm:rounded-md">
    <ul role="list" class="divide-y divide-gray-200">
      <% @stations.each do |station| %>
        <li class="px-6 py-4 hover:bg-gray-50">
          <%= render partial: 'station', locals: { station: station } %>
        </li>
      <% end %>
    </ul>
  </div>
</div>

<%= javascript_tag do %>
  document.getElementById('useLocation').addEventListener('click', function() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        const form = document.querySelector('form');
        
        // Remove any existing hidden coordinates
        const existingLat = form.querySelector('input[name="latitude"]');
        const existingLng = form.querySelector('input[name="longitude"]');
        if (existingLat) existingLat.remove();
        if (existingLng) existingLng.remove();
        
        // Add new coordinates
        const latitude = document.createElement('input');
        const longitude = document.createElement('input');
        
        latitude.type = 'hidden';
        longitude.type = 'hidden';
        latitude.name = 'latitude';
        longitude.name = 'longitude';
        latitude.value = position.coords.latitude;
        longitude.value = position.coords.longitude;
        
        form.appendChild(latitude);
        form.appendChild(longitude);
        
        // Clear the location field since we're using coordinates
        const locationField = form.querySelector('input[name="location"]');
        if (locationField) locationField.value = '';
        
        form.submit();
      }, function(error) {
        alert('Unable to get your location. Please enter an address manually.');
      });
    } else {
      alert('Geolocation is not supported by this browser. Please enter an address manually.');
    }
  });
<% end %>