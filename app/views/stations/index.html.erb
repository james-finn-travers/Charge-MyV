<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <% if user_signed_in? %>
    <div class="mb-6 p-4 bg-green-50 border border-green-200 rounded-md">
      <p class="text-green-800 text-sm">
        Welcome back! Use the filters below to find charging stations near you.
      </p>
    </div>
  <% end %>
  
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900">Find Charging Stations</h1>
    
    <%= form_tag find_stations_path, method: :get, class: "mt-4 space-y-4" do %>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="flex-1">
          <%= label_tag :location, "Address or Location", class: "block text-sm font-medium text-gray-700" %>
          <%= text_field_tag :location, params[:location], 
              class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",
              placeholder: "Enter address or city" %>
        </div>
        
        <div class="w-full">
          <%= label_tag :radius, "Radius (km)", class: "block text-sm font-medium text-gray-700" %>
          <%= number_field_tag :radius, params[:radius] || 10, 
              class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",
              min: 1, max: 50 %>
        </div>

        <div class="w-full">
          <label class="block text-sm font-medium text-gray-700 mb-2">Connector Types</label>
          <div class="space-y-2">
            <div class="flex items-center">
              <%= check_box_tag 'charging_types[]', 'Type 1', params[:charging_types]&.include?('Type 1'), 
                  class: "h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" %>
              <label class="ml-2 text-sm text-gray-700">Type 1 (J1772)</label>
            </div>
            <div class="flex items-center">
              <%= check_box_tag 'charging_types[]', 'Type 2', params[:charging_types]&.include?('Type 2'), 
                  class: "h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" %>
              <label class="ml-2 text-sm text-gray-700">Type 2 (Mennekes)</label>
            </div>
            <div class="flex items-center">
              <%= check_box_tag 'charging_types[]', 'CCS', params[:charging_types]&.include?('CCS'), 
                  class: "h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" %>
              <label class="ml-2 text-sm text-gray-700">CCS (Combo)</label>
            </div>
            <div class="flex items-center">
              <%= check_box_tag 'charging_types[]', 'CHAdeMO', params[:charging_types]&.include?('CHAdeMO'), 
                  class: "h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" %>
              <label class="ml-2 text-sm text-gray-700">CHAdeMO</label>
            </div>
            <div class="flex items-center">
              <%= check_box_tag 'charging_types[]', 'Tesla', params[:charging_types]&.include?('Tesla'), 
                  class: "h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" %>
              <label class="ml-2 text-sm text-gray-700">Tesla</label>
            </div>
          </div>
        </div>
      </div>

      <%= submit_tag "Search", class: "mt-4 px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700" %>
    <% end %>

    <button id="useLocation" class="mt-2 text-sm text-indigo-600 hover:text-indigo-800">
      Use my current location
    </button>
  </div>

  <div class="bg-white shadow overflow-hidden sm:rounded-md">
    <ul role="list" class="divide-y divide-gray-200">
      <% @stations.each do |station| %>
        <li class="px-6 py-4 hover:bg-gray-50">
          <%= render partial: 'station', locals: { station: station } %>
        </li>
      <% end %>
    </ul>
  </div>
</div>

<%= javascript_tag do %>
  document.getElementById('useLocation').addEventListener('click', function() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        const form = document.querySelector('form');
        
        // Remove any existing hidden coordinates
        const existingLat = form.querySelector('input[name="latitude"]');
        const existingLng = form.querySelector('input[name="longitude"]');
        if (existingLat) existingLat.remove();
        if (existingLng) existingLng.remove();
        
        // Add new coordinates
        const latitude = document.createElement('input');
        const longitude = document.createElement('input');
        
        latitude.type = 'hidden';
        longitude.type = 'hidden';
        latitude.name = 'latitude';
        longitude.name = 'longitude';
        latitude.value = position.coords.latitude;
        longitude.value = position.coords.longitude;
        
        form.appendChild(latitude);
        form.appendChild(longitude);
        
        // Clear the location field since we're using coordinates
        const locationField = form.querySelector('input[name="location"]');
        if (locationField) locationField.value = '';
        
        form.submit();
      }, function(error) {
        alert('Unable to get your location. Please enter an address manually.');
      });
    } else {
      alert('Geolocation is not supported by this browser. Please enter an address manually.');
    }
  });
<% end %>
